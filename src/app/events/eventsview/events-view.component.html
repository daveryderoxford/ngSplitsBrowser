
<div class="main-container">

<app-navbar></app-navbar>

  <mat-tab-group (selectedTabChange)="tabChanged($event)" backgroundColor="primary">
    <mat-tab #tabAll label="ALL">
      <ng-template matTabContent>

        <div class="background">

          <div class="data-container mat-elevation-z2" (scroll)="onTableScroll($event)">

            <app-events-table [dataSource]="dataSource" (eventSelected)="oeventClicked($event)"></app-events-table>
            
            <mat-progress-bar *ngIf="loading | async" mode="indeterminate"></mat-progress-bar>

          </div>
        </div>

      </ng-template>
    </mat-tab>

    <mat-tab #tabClub label="CLUB">
      <ng-template matTabContent>

        <div class="background">

          <div class="class-filter">
            <mat-form-field>
              <mat-select placeholder="Nationality" (selectionChange)="clubNationalFilterChange($event)">
                <mat-option *ngFor="let nation of nations" [value]="nation.abrievation">
                  {{ nation.fullname }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field>
              <input matInput #clubNameFilter placeholder="Name" (keyup)="clubNameFilterChange($event)">    
            </mat-form-field>
          </div>

          <div class="data-container mat-elevation-z2">

            <mat-accordion multi="false">

              <div *ngFor="let club of clubs$ | async">

              <mat-expansion-panel (opened)="setSelectedClub(club)">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <b> {{club.name}} &nbsp;&nbsp;&nbsp; {{club.nationality}} </b>
                  </mat-panel-title>
                  <mat-panel-description>
                    {{club.numEvents}} events &nbsp;&nbsp;&nbsp; Last event {{club.lastEvent | date}}
                  </mat-panel-description>
                </mat-expansion-panel-header>

                <ng-template matExpansionPanelContent>

                    <app-events-table [dataSource]="clubEvents" (eventSelected)="oeventClicked($event)"></app-events-table>
                    
                </ng-template>

              </mat-expansion-panel>
            </div>
            <mat-progress-bar *ngIf="loading | async" mode="indeterminate"></mat-progress-bar>

            </mat-accordion>

          </div>
        </div>

      </ng-template>

    </mat-tab>

    <mat-tab #tabMyEvents label="MY RESULTS">
      <ng-template matTabContent>

        <mat-list *ngFor="let result of myResults$ | async">
          <mat-list-item> {{result.eventInfo.na}</mat-list-item>
        </mat-list>
      </ng-template>
    </mat-tab>

  </mat-tab-group>

</div>

<mat-menu #appMenu="matMenu" xPosition="before">
  <button (click)="graphMenuSelected(selectedEvent)" mat-menu-item>Graph</button>
  <button (click)="summaryMenuSelected(selectedEvent)" mat-menu-item>Summary</button>
  <button *ngIf="eventEditable(selectedEvent)" (click)="adminMenuSelected(selectedEvent)" mat-menu-item>Admin</button>
</mat-menu>