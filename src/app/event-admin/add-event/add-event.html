<app-toolbar title="Upload new event" style="grid-area: toolbar" />

<mat-stepper orientation="horizontal" [linear]="true" class="steps">

   <mat-step label="Details">
      <app-event-form (submitted)="saveEventDetails($event)" />
   </mat-step>

   <mat-step label="Upload results">
      <p>
         Select results file to upload.
      </p>
      <file-button (fileSelected)="uploadSplits($event)" [disabled]="busy()" label="Select results file" />

   </mat-step>

   <mat-step label="Done">
         @let evt = oevent();
         @if (evt) {
            @let splits = evt.splits;

            <p class="mat-title-medium">
               Results uploaded.
            </p>
  
            @if (splits?.valid) {
               <p>
                  {{evt.summary?.numcompetitors}} competitors<br>
                  {{evt.summary?.courses.length}} courses
               </p>

               <p>
                  <a [href]="resultsUrl()">Display results</a>
                  <mat-icon (click)="copyText(resultsUrl())" class="copy-icon" matTooltip="Copy URL">content_copy</mat-icon>
               </p>
            } @else {
               <p>Error in uploaded splits - Correct error and upload again</p>
               @if (splits?.failurereason) {
                  <p>Error {{splits.failurereason}}</p>
               } 
            } 
         } @else {
            <p class="mat-title-medium">Splits not uploaded. Upload splits using Evemt Admin menu.</p>
         }
         <p></p>
      <button mat-flat-button (click)="done()">Done</button>
   </mat-step>
</mat-stepper>
